# 关系图功能特性说明

## 已实现的功能

### 1. 关系图列表页 (`RelationshipList.vue`)
- **网格布局展示**: 280x210 的关系图卡片
- **智能缩略图**: 根据关系图数据自动生成可视化缩略图
- **创建功能**: 支持名称和描述输入
- **右键菜单**: 编辑和删除操作
- **自动更新**: 缩略图自动更新机制

### 2. 关系图编辑页 (`RelationshipDesign.vue`)
- **可视化编辑**: 使用 `relation-graph-vue3` 插件
- **人物集成**: 支持从人物谱中选择人物节点
- **自定义节点**: 支持创建自定义节点（地点、事件、物品）
- **连线管理**: 节点间关系定义和管理
- **节点详情**: 点击节点查看详情和删除
- **数据验证**: 防止重复连线等错误操作

### 3. 数据集成
- **人物谱数据**: 自动加载和选择人物数据
- **标签系统**: 支持从字典词条中选择标签
- **文件管理**: 自动创建和管理关系图文件

## 技术特性

### 缩略图生成
- 使用 Canvas API 生成关系图缩略图
- 支持节点和连线的可视化展示
- 自动布局算法（圆形布局）
- 节点颜色分类（人物、地点、事件、物品）

### 图表配置
- 力导向布局算法
- 自定义节点和连线样式
- 响应式设计
- 事件处理（点击、拖拽等）

### 数据同步
- 实时数据更新
- 自动保存机制
- 文件系统集成
- 错误处理和恢复

## 使用流程

### 创建关系图
1. 在关系图列表页点击"创建关系图"
2. 输入关系图名称和描述
3. 系统自动创建空白关系图并跳转到编辑页

### 编辑关系图
1. **添加节点**:
   - 选择"人物"类型：从人物谱中选择已有人物
   - 选择"自定义"类型：创建新的节点
2. **添加连线**:
   - 选择起始节点和目标节点
   - 定义关系类型和描述
3. **管理节点**:
   - 点击节点查看详情
   - 删除节点（同时删除相关连线）

### 保存和同步
- 点击"保存"按钮保存关系图数据
- 系统自动更新缩略图
- 数据实时同步到文件系统

## 文件结构

```
books/
├── 书名/
│   ├── relationships/
│   │   ├── 关系图1.png      # 自动生成的缩略图
│   │   ├── 关系图1.json     # 关系图数据
│   │   └── ...
│   ├── characters.json      # 人物谱数据
│   └── dictionary.json      # 字典数据
```

## 数据格式

### 关系图数据 (JSON)
```json
{
  "id": "唯一标识符",
  "name": "关系图名称",
  "description": "关系图描述",
  "thumbnail": "base64编码的缩略图",
  "nodes": [
    {
      "id": "节点ID",
      "name": "节点名称",
      "type": "节点类型",
      "description": "节点描述",
      "characterId": "关联的人物ID（可选）"
    }
  ],
  "edges": [
    {
      "id": "连线ID",
      "source": "起始节点ID",
      "target": "目标节点ID",
      "type": "关系类型",
      "description": "关系描述"
    }
  ],
  "createdAt": "创建时间",
  "updatedAt": "更新时间"
}
```

## 节点类型

- **character**: 人物节点（蓝色）
- **location**: 地点节点（绿色）
- **event**: 事件节点（橙色）
- **item**: 物品节点（红色）

## 待优化功能

1. **拖拽编辑**: 支持节点拖拽定位
2. **连线样式**: 更多连线样式选择
3. **布局算法**: 更多布局选项
4. **导出功能**: 支持导出为图片
5. **搜索功能**: 节点和关系搜索
6. **批量操作**: 批量添加节点和连线 